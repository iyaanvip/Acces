<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Aktifkan Notifikasi</title>
</head>
<body>
  <h1>Aktifkan Notifikasi</h1>
  <button id="enableNotif">Aktifkan</button>
  <div id="status"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCs_Jb63WZGevle_OXM2jlOS36aftE_29Y",
      authDomain: "adminvvip.firebaseapp.com",
      databaseURL: "https://adminvvip-default-rtdb.firebaseio.com",
      projectId: "adminvvip",
      storageBucket: "adminvvip.firebasestorage.app",
      messagingSenderId: "911235567086",
      appId: "1:911235567086:web:8d178b73c3b48b790ed2ff",
      measurementId: "G-M5RS20R3P3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const messaging = firebase.messaging();

    navigator.serviceWorker.register('sw.js').then(reg => {
      if (messaging.useServiceWorker) messaging.useServiceWorker(reg);
    });

    document.getElementById("enableNotif").addEventListener("click", async () => {
      const status = document.getElementById("status");
      try {
        const perm = await Notification.requestPermission();
        if (perm !== "granted") {
          status.textContent = "Izin ditolak.";
          return;
        }
        const token = await messaging.getToken({
          vapidKey: "BFJKG8J6cnoeIESulLITwBFqNGIQ8CA74fELmWOR5tox-87kIb3HlfZBijG4FfiuNkBOYp0BNbweTXpd46PpS10"
        });
        if (!token) {
          status.textContent = "Gagal mendapatkan token.";
          return;
        }
        const snap = await db.ref("tokens").once("value");
        const exists = Object.values(snap.val() || {}).includes(token);
        if (!exists) await db.ref("tokens").push(token);
        status.textContent = "Notifikasi diaktifkan.";
      } catch (err) {
        console.error(err);
        status.textContent = "Terjadi kesalahan.";
      }
    });
  </script>
</body>
</html>
